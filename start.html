<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="username.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Title</title>
</head>
<body>
<header>
    <div  class="navigation">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="app.html">List of TreasureHunts</a></li>
        </ul>
    </div>
</header>
<main>
    <h2 class="username-text">Please enter your username for the treasure hunt quiz to start</h2>
<form method='get' onsubmit="startTH()" class="form">
    <input type="text"  id="player" minlength="3" maxlength="20" placeholder="Type your username here" required>
    <input type="submit" id="leadbutton" class="submitButton">
</form>
<script>
    function setCookie(cookieName, cookieValue, expireDays) {
        let date = new Date();
        date.setTime(date.getTime() + (expireDays * 24 * 60 * 60 * 1000));
        let expires = "expires=" + date.toUTCString();
        document.cookie = cookieName + "=" + cookieValue + ";" + expires + ";path=/";
    }



    const params = new URLSearchParams(location.search);
    let id = "";
    //get the treasure hunt id from the url to use it for the fetch funnction
    if(params.has("treasure-hunt-id")){
        id = params.get("treasure-hunt-id");
    }

    let string = "&app=treasureHuntGroupA2&treasure-hunt-id=" + id;
    let session = "";
    let alphaNumeric = /^[a-zA-Z0-9]+$/;
    function getCookieValue(cookieName) {
        let array = cookieName.split("; ");
        for (let i = 0; i < array.length; i++) {
            let cookie = array[i];
            let [name, value] = cookie.split("=");
            if (name == "session") {
                return value;
            }
        }
    }

        //prompt the user to enter it;s username so the treasure hunt questions can start

        async function startTH() {
            event.preventDefault();
            let player = document.getElementById('player').value;
            if (alphaNumeric.test(player) == false) {
                alert("The characters you entered are not alphanumeric!! Enter a valid username");
            } else {
            await fetch("https://codecyprus.org/th/api/start?player=" + player + string).then(response => response.json()) //Parse JSON text to JavaScript object
                .then(jsonObject => {
                    if (jsonObject.status === "OK") {
                        setCookie("session", jsonObject.session, 10);
                        setCookie('playerName', player, 5);
                        document.getElementById('player').innerHTML = "";
                        window.location.href = "question.html";
                    } else {
                        alert(jsonObject.errorMessages);
                    }
                });
        }



    }



</script>
</main>
<footer>
    Copyright Â© 2024 UCLan Cyprus, All rights reserved.
</footer>
</body>
</html>