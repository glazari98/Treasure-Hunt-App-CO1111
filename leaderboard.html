<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="app.css"/>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-529VLQPE0H"></script>
    <title>Leaderboard</title>
</head>
<body>

<header>

    <div  class="navigation">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="app.html">List of Treasure Hunts</a></li>
            <li><a href="index.html#aims" >About Us</a></li>
        </ul>
    </div>
</header>
<main>
    <div class="container">
        <p>Leaderboard</p>
        <ul id="challenges"></ul>
    </div>
</main>




<footer>
    Copyright Â© 2024 UCLan Cyprus, All rights reserved.
</footer>
<script>

    const TH_API_URL = "https://codecyprus.org/th/api/";
    // the API base url/*** This is a function to access the /leaderboard at the specified URL*/
    function getLeaderBoard(url) {// create and invoke the http request
        fetch(url, { method: "GET" }).then(response => response.json()).then(json => handleLeaderboard(json));
    }// for now, hardcoded
    let session = sessionStorage.getItem('session');
    let url = TH_API_URL + "leaderboard?sorted&session=" + session; // form url
    getLeaderBoard(url);

    function handleLeaderboard(leaderboard) {
        let htm = document.getElementById('challenges'); // used to include HTML code for the table rows
        let leaderboardArray = leaderboard.leaderboard;
        for(const entry of leaderboardArray) {
            let html = document.createElement('li');
            html.innerHTML = 
                entry['player'] + " - " +
                entry['score'] + " - " +
                new Date(entry['completionTime']).toLocaleString();

            htm.appendChild(html);
            
        }
        // append generated HTML to existing
        console.log(leaderboardArray);
    }
</script>

</body>
</html>
