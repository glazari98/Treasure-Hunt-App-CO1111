<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="app.css"/>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-529VLQPE0H"></script>
    <title>Leaderboard</title>
</head>
<body>

<header>

    <div  class="navigation">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="app.html">Treasure Hunts</a></li>
            <li><a href="index.html#aims" >About Us</a></li>
        </ul>
    </div>
</header>
<main>
    <div class="container">
        <p>Leaderboard Top 10:</p>

        <ul id="challenges"></ul>
    </div>
</main>

<footer>
    Copyright Â© 2024 UCLan Cyprus, All rights reserved.
</footer>
<script>

    const TH_API_URL = "https://codecyprus.org/th/api/";
    // the API base url/*** This is a function to access the /leaderboard at the specified URL*/
    function getLeaderBoard(url) {
        fetch(url, { method: "GET" }).then(response => response.json()).then(json => handleLeaderboard(json));
    }

    var cookies1 = document.cookie;
    function getCookieValue(cookieName){
        let array = cookieName.split("; ");
        for(let i=0; i < array.length; i++){
            let cookie = array[i];
            let [name,value] =  cookie.split("=");
            if (name == "session"){
                return value;
            }
        }
    }
    let sessionID = getCookieValue(cookies1);
    //let session = sessionStorage.getItem('session');
    let url = TH_API_URL + "leaderboard?sorted&session=" + sessionID + "&limit=10"; // form url
    getLeaderBoard(url);

    function handleLeaderboard(leaderboard) {
        let htm = document.getElementById('challenges'); // used to include HTML code for the table rows
        let leaderboardArray = leaderboard.leaderboard;
        for(const entry of leaderboardArray) {
            let html = document.createElement('li');
            html.innerHTML = 
                "Player name: " + entry['player'] + " Points: " +
                entry['score'] + "<br> Time completed: " +
                new Date(entry['completionTime']).toLocaleString();

            htm.appendChild(html);
            
        }
        // append generated HTML to existing
        console.log(leaderboardArray);
    }
</script>

</body>
</html>
