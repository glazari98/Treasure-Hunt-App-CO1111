<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Questions</title>
</head>
<body>

<div id="question">
</div>
<form id="answer" onsubmit="getQuestion()"><input type="text" id="inputField" ><input type="submit"></form>
<script>
    const params = new URLSearchParams(location.search);
    //get the session from the url
    let ok = "";
    if(params.has("session")){
        ok = params.get("session");
        sessionStorage.setItem('session', ok);
    }
    let question = document.getElementById('question');
    let formElement = document.getElementById('answer');
    //receive the question information and display the question
    function getQuestion() {
        fetch("https://codecyprus.org/th/api/question?session=" + ok).then(response => response.json())
            .then(jsonObject => {
                console.log(jsonObject);
                question.innerText = jsonObject.questionText;
            });
    }
    getQuestion();

    formElement.addEventListener('submit', getAnswer);
    //function to retrieve the answer and send it to the api to see if it's correct
    async function getAnswer(){
        //prevent the submission of the form so the page doesn't reload so we don't loose the session id from the url
        event.preventDefault();
        let answer = document.getElementById('inputField').value;
        //check if the user's answer is correct
        await fetch("https://codecyprus.org/th/api/answer?session=" + ok + "&answer=" + answer)
            .then(response => response.json())
            .then(jsonObject => {
                console.log(jsonObject);
            });

        //go to the next question only if you submit a correct answer
        await getQuestion();
    }




</script>
</body>
</html>